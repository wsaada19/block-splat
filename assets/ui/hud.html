<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Jolly+Lodger&display=swap"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
  rel="stylesheet"
/>
<style>
  /* Common styles */
  .gradient-bg {
    background: linear-gradient(
      to bottom,
      rgba(40, 40, 40, 0.92),
      rgba(25, 25, 25, 0.92)
    );
    border: 3px solid rgba(180, 180, 180, 0.4);
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    border-radius: 12px;
    backdrop-filter: blur(4px);
  }

  .panel-bg {
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    backdrop-filter: blur(4px);
  }

  .hud-panel {
    position: fixed;
    right: 20px;
    bottom: 20px;
    padding: 12px;
    width: 160px;
  }

  .panel-row {
    display: flex;
    align-items: center;
    margin: 8px 0;
    padding: 6px 8px;
    background: rgba(30, 30, 30, 0.6);
    border: 1px solid rgba(200, 200, 200, 0.15);
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .panel-row:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(-3px);
  }

  .panel-row.red-team {
    background: rgba(255, 68, 68, 0.2);
    border: 1px solid rgba(255, 68, 68, 0.4);
    box-shadow: 0 0 10px rgba(255, 68, 68, 0.2);
  }

  .panel-name {
    flex: 1;
    color: #ffffff;
    font-family: "Trebuchet MS", "Arial", sans-serif;
    font-size: 15px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    letter-spacing: 0.5px;
  }

  .panel-name.red-team {
    color: #ff4444;
    font-weight: bold;
  }
  .panel-name.blue-team {
    color: #4444ff;
    font-weight: bold;
  }

  .panel-value {
    font-weight: bold;
    font-size: 20px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    font-family: "Georgia", serif;
    padding: 0 4px;
    border-radius: 4px;
  }

  .time-value {
    color: #ffffff;
    font-weight: bold;
    font-family: "Trebuchet MS", "Arial", sans-serif;
  }

  .red-background {
    background: rgba(255, 68, 68, 0.8);
    border: 1px solid rgba(255, 68, 68, 0.8);
    box-shadow: 0 0 10px rgba(255, 68, 68, 0.2);
  }

  .blue-background {
    background: rgba(68, 68, 255, 0.8);
    border: 1px solid rgba(68, 68, 255, 0.8);
    box-shadow: 0 0 10px rgba(68, 68, 255, 0.2);
  }

  .red-score {
    color: #ff4444;
    text-shadow: 0 0 8px rgba(255, 68, 68, 0.4);
  }
  .blue-score {
    color: #4444ff;
    text-shadow: 0 0 8px rgba(68, 68, 255, 0.4);
  }

  .team-indicator {
    font-size: 12px;
    padding: 2px 6px;
    border-radius: 3px;
    margin-left: 8px;
    background: rgba(0, 0, 0, 0.3);
    color: #ffffff;
  }

  .your-team .team-indicator {
    display: inline-block;
  }

  /* Game Over Screen */
  .game-over {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    animation: fadeIn 0.5s ease-in;
  }

  .game-over-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    animation: scaleIn 0.5s ease-out;
  }

  .winner-text {
    font-family: "Trebuchet MS", "Arial", sans-serif;
    font-size: 48px;
    color: #00ffaa;
    text-shadow: 0 0 20px rgba(0, 255, 170, 0.6),
      0 0 40px rgba(0, 255, 170, 0.4);
    margin-bottom: 20px;
    animation: pulse 2s infinite;
  }

  /* Class Selection */
  .class-select {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    padding: 28px;
    width: 700px;
    display: none;
    justify-content: space-around;
    gap: 20px;
  }

  body.mobile .class-select {
    width: 90%;
    max-width: 400px;
    padding: 16px;
    gap: 12px;
    flex-wrap: wrap;
  }

  .close-button {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 30px;
    height: 30px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    color: white;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  body.mobile .close-button {
    width: 24px;
    height: 24px;
    font-size: 16px;
    top: 8px;
    right: 8px;
  }

  .close-button:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
  }

  /* Leaderboard */
  #player-leaderboard {
    display: none;
    padding: 24px;
    top: 20%;
    width: 60%;
    position: fixed;
    justify-content: space-around;
    left: 50%;
    top: 30%;
    opacity: 1;
    transform: translate(-50%, -50%);
    z-index: 1000;
  }

  body.mobile #player-leaderboard {
    width: 90%;
    padding: 16px;
    gap: 12px;
  }

  .leaderboard {
    padding: 8px;
    width: 100%;
  }

  body.mobile .leaderboard {
    padding: 4px;
  }

  .leaderboard-title {
    color: #ffffff;
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 16px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  body.mobile .leaderboard-title {
    font-size: 18px;
    margin-bottom: 12px;
  }

  .leaderboard-header {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    padding: 8px 16px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    color: #aaaaaa;
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 8px;
  }

  body.mobile .leaderboard-header {
    padding: 6px 8px;
    font-size: 12px;
  }

  .leaderboard-entry {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    padding: 6px 8px;
    margin: 2px 0;
    color: white;
    font-weight: bold;
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  body.mobile .leaderboard-entry {
    padding: 4px 6px;
    font-size: 12px;
  }

  #red-leaderboard {
    background: rgba(200, 30, 30, 0.95);
  }
  #blue-leaderboard {
    background: rgba(30, 30, 200, 0.95);
  }

  /* Class Cards */
  .class-card {
    width: 160px;
    background: rgba(60, 60, 60, 0.4);
    border: 2px solid rgba(200, 200, 200, 0.2);
    border-radius: 8px;
    padding: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  body.mobile .class-card {
    min-width: 140px;
    padding: 6px;
  }

  .class-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    border-color: rgba(200, 200, 200, 0.4);
  }

  body.mobile .class-card:hover {
    transform: translateY(-2px);
  }

  .class-card.selected {
    border-color: #00ffaa;
    box-shadow: 0 0 15px rgba(0, 255, 170, 0.3);
  }

  .class-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 10px;
  }

  body.mobile .class-icon {
    width: 48px;
    height: 48px;
    margin: 0 auto 6px;
  }

  .class-name {
    color: #ffffff;
    font-size: 22px;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  body.mobile .class-name {
    font-size: 16px;
    margin-bottom: 6px;
  }

  .class-desc {
    color: #cccccc;
    font-size: 14px;
    margin-bottom: 15px;
    line-height: 1.4;
  }

  body.mobile .class-desc {
    font-size: 11px;
    margin-bottom: 8px;
    line-height: 1.3;
  }

  .class-stats {
    text-align: left;
    margin-top: 10px;
    padding: 0 10px;
  }

  body.mobile .class-stats {
    margin-top: 6px;
    padding: 0 6px;
  }

  .stat {
    color: #aaaaaa;
    font-size: 13px;
    margin: 4px 0;
  }

  body.mobile .stat {
    font-size: 10px;
    margin: 2px 0;
  }

  .stat.pro {
    color: #00ff00;
  }
  .stat.con {
    color: #ff4444;
  }

  /* Stamina */
  .stamina-container {
    position: fixed;
    bottom: 18px;
    right: 4px;
    width: 224px;
    height: 200px;
    z-index: 1000;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  body.mobile .stamina-container {
    width: 120px;
    height: 100px;
    top: 40%;
    bottom: 0;
  }

  .paint-splat-bg {
    position: absolute;
    width: 100%;
    height: 100%;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    z-index: 1;
    transition: filter 0.3s ease;
  }

  .paint-splat-bg img {
    object-fit: cover;
    width: 100%;
    transition: opacity 0.3s ease, filter 0.3s ease;
  }

  .stamina-text {
    position: absolute;
    color: white;
    font-family: Arial, sans-serif;
    font-size: 22px;
    padding-right: 6px;
    padding-bottom: 8px;
    font-weight: bold;
    z-index: 3;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  }

  body.mobile .stamina-text {
    font-size: 14px;
    padding-top: 2px;
    padding-bottom: 0;
  }

  /* Crosshair */
  .crosshair {
    position: fixed;
    left: 50%;
    top: 45%;
    transform: translate(-50%, -50%);
    width: 16px;
    height: 16px;
    opacity: 1;
    pointer-events: none;
  }

  .crosshair::before,
  .crosshair::after {
    content: "";
    position: absolute;
    background: rgba(50, 50, 50, 0.8);
  }

  .crosshair::before {
    left: 50%;
    top: 0;
    width: 2px;
    height: 100%;
    transform: translateX(-50%);
  }

  .crosshair::after {
    top: 50%;
    left: 0;
    height: 2px;
    width: 100%;
    transform: translateY(-50%);
  }

  /* Respawn Screen */
  .respawn-screen {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    animation: fadeIn 0.3s ease-in;
  }

  .respawn-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    animation: scaleIn 0.3s ease-out;
  }

  .death-message {
    font-family: "Trebuchet MS", "Arial", sans-serif;
    font-size: 32px;
    color: #ff4444;
    text-shadow: 0 0 20px rgba(255, 68, 68, 0.6);
    margin-bottom: 20px;
  }

  .respawn-timer {
    font-family: "Georgia", serif;
    font-size: 48px;
    color: #ffffff;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
    animation: pulse 1s infinite;
  }

  /* Team Banner */
  .team-banner {
    position: static;
    min-width: 80px;

    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 15px;
    color: white;
    font-family: "Trebuchet MS", "Arial", sans-serif;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  body.mobile .team-banner {
    min-width: 40px;
  }

  .team-banner.red {
    background: rgba(200, 30, 30, 0.95);
  }
  .team-banner.blue {
    background: rgba(30, 30, 200, 0.95);
  }

  .team-name {
    display: none;
  }

  .team-score {
    font-size: 28px;
    font-family: "Roboto", serif;
    font-weight: bold;
  }

  /* Controls Panel */
  .controls-panel {
    position: fixed;
    right: 20px;
    top: 80px;
    padding: 12px;
    width: 200px;
  }

  /* Player Stats */
  .player-stats {
    position: fixed;
    right: 20px;
    top: 200px;
    height: 100px;
    width: 100px;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 10px 12px;
    backdrop-filter: blur(4px);
  }

  body.mobile .player-stats {
      top: 10px;
      bottom: 0;
      height: 90px;
      width: 80px;

      .player-name {
        font-size: 12px;
        margin-bottom: 4px;
      }

      .stat-counter {
        font-size: 11px;
      }

      .stat-label {
        font-size: 10px;
      }

      .stat-value {
        font-size: 12px;
      }
    }

  .player-name {
    color: #ffffff;
    font-family: "Roboto", sans-serif;
    font-size: 14px;
    text-align: center;
    font-weight: 500;
    margin-bottom: 6px;
    opacity: 0.9;
    text-transform: uppercase;
  }

  .stats-row {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .stat-counter {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 13px;
  }

  .stat-label {
    color: rgb(255, 255, 255);
    font-family: "Roboto", sans-serif;
    font-size: 12px;
    font-weight: 500;
  }

  .stat-value {
    font-size: 13px;
    color: #ffffff;
    font-family: "Roboto", sans-serif;
    font-weight: 500;
  }

  .points-count .stat-value {
    color: #44ff44;
  }
  .kills-count .stat-value {
    color: #44ff44;
  }
  .death-count .stat-value {
    color: #ff4444;
  }

  .current-class {
    margin-top: 4px;
    padding-top: 4px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
    color: #ffffff;
    font-size: 14px;
    font-weight: 500;
    opacity: 0.9;
  }

  .red-background {
    border-color: rgba(255, 68, 68, 0.3);
  }

  .blue-background {
    border-color: rgba(68, 68, 255, 0.3);
  }

  /* Score Time Container */
  .score-time-container {
    position: fixed;
    top: 0px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: stretch;
    height: 48px;
    background: rgba(40, 40, 40, 0.92);
  }

  .time-display {
    position: static;
    padding: 0 20px;

    display: flex;
    align-items: center;
  }

  body.mobile .time-display {
    padding: 0 8px;
  }

  .time-label {
    color: #ffffff;
    font-family: "Trebuchet MS", "Arial", sans-serif;
    font-size: 20px;

    font-weight: bold;
    text-align: center;
  }

  body.mobile .time-label {
    font-size: 10px;
  }

  /* Game Message */
  .my-game-message {
    background: rgba(0, 0, 0, 0.8);
    border-radius: 12px;
    padding: 6px 10px;
    color: white;
    text-align: center;
    position: relative;
    margin-bottom: 15px;
  }

  .my-game-message p {
    font-family: Arial, sans-serif;
    user-select: none;
    font-size: 14px;
    font-weight: bold;
    margin: 0;
  }

  /* Instructions */
  .instructions {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    pointer-events: none;
  }

  .instructions.visible {
    display: block;
    pointer-events: auto;
  }

  .instructions-title {
    font-family: "Jolly Lodger", serif;
    font-size: 64px;
    color: #4488ff;
    text-align: center;
    margin: 0 0 12px 0;
  }

  body.mobile .instructions-title {
    font-size: 36px;
    margin: 0 0 8px 0;
  }

  .instructions-panel {
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 20px;
    color: white;
    font-family: "Trebuchet MS", Arial, sans-serif;
    width: 500px;
    font-size: 18px;
  }

  body.mobile .instructions-panel {
    width: 95%;
    max-width: 450px;
    padding: 10px;
    font-size: 12px;
  }

  .instruction-section {
    margin: 12px 0;
  }

  body.mobile .instruction-section {
    margin: 8px 0;
  }

  .instruction-section h3 {
    color: #4488ff;
    margin: 0 0 8px 0;
    font-size: 24px;
    font-weight: bold;
  }

  body.mobile .instruction-section h3 {
    font-size: 18px;
    margin: 0 0 6px 0;
  }

  .instruction-section ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px;
  }

  body.mobile .instruction-section ul {
    grid-template-columns: 1fr 1fr;
    gap: 2px;
  }

  .instruction-section li {
    margin: 5px 0;
    font-size: 16px;
    color: #cccccc;
    padding-right: 10px;
  }

  body.mobile .instruction-section li {
    margin: 3px 0;
    font-size: 12px;
    padding-right: 0;
  }

  .instruction-section strong {
    font-size: 18px;
  }

  body.mobile .instruction-section strong {
    font-size: 14px;
  }

  .instruction-section p {
    margin: 5px 0;
    font-size: 16px;
    color: #cccccc;
  }

  body.mobile .instruction-section p {
    margin: 3px 0;
    font-size: 12px;
  }

  /* Victory/Defeat Screens */
  .victory-screen,
  .defeat-screen {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 1000;
    animation: fadeIn 0.4s ease-in;
  }

  .victory-content,
  .defeat-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    animation: scaleIn 0.5s ease-out;
    padding: 40px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
  }

  .victory-content {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(16, 185, 129, 0.15));
    border: 3px solid rgba(34, 197, 94, 0.4);
    box-shadow: 0 0 30px rgba(34, 197, 94, 0.3), inset 0 0 20px rgba(34, 197, 94, 0.1);
  }

  .defeat-content {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.15));
    border: 3px solid rgba(239, 68, 68, 0.4);
    box-shadow: 0 0 30px rgba(239, 68, 68, 0.3), inset 0 0 20px rgba(239, 68, 68, 0.1);
  }

  .victory-message {
    font-size: 72px;
    font-family: "Roboto", sans-serif;
    font-weight: 900;
    background: linear-gradient(45deg, #22c55e, #10b981, #059669);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
    margin-bottom: 20px;
    animation: gradientShift 3s ease-in-out infinite, victoryGlow 2s ease-in-out infinite alternate;
    letter-spacing: 2px;
  }

  .victory-team {
    font-size: 48px;
    font-family: "Roboto", sans-serif;
    font-weight: 700;
    color: #ffffff;
    text-shadow: 0 0 20px rgba(34, 197, 94, 0.8), 2px 2px 4px rgba(0, 0, 0, 0.5);
    margin-top: 20px;
    animation: teamGlow 2s ease-in-out infinite alternate;
  }

  .defeat-message {
    font-size: 72px;
    font-family: "Roboto", sans-serif;
    font-weight: 900;
    background: linear-gradient(45deg, #ef4444, #dc2626, #b91c1c);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(239, 68, 68, 0.6);
    margin-bottom: 20px;
    animation: gradientShift 3s ease-in-out infinite, defeatGlow 2s ease-in-out infinite alternate;
    letter-spacing: 2px;
  }

  .defeat-team {
    font-size: 48px;
    font-family: "Roboto", sans-serif;
    font-weight: 700;
    color: #ffffff;
    text-shadow: 0 0 20px rgba(239, 68, 68, 0.8), 2px 2px 4px rgba(0, 0, 0, 0.5);
    margin-top: 20px;
    animation: teamGlow 2s ease-in-out infinite alternate;
  }

  /* Victory/Defeat Animations */
  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @keyframes victoryGlow {
    0% { text-shadow: 0 0 30px rgba(34, 197, 94, 0.6); }
    100% { text-shadow: 0 0 50px rgba(34, 197, 94, 0.9), 0 0 70px rgba(34, 197, 94, 0.4); }
  }

  @keyframes defeatGlow {
    0% { text-shadow: 0 0 30px rgba(239, 68, 68, 0.6); }
    100% { text-shadow: 0 0 50px rgba(239, 68, 68, 0.9), 0 0 70px rgba(239, 68, 68, 0.4); }
  }

  @keyframes teamGlow {
    0% { text-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 2px 2px 4px rgba(0, 0, 0, 0.5); }
    100% { text-shadow: 0 0 30px rgba(255, 255, 255, 1), 2px 2px 4px rgba(0, 0, 0, 0.5); }
  }

  /* Buttons */
  .help-button,
  .select-class-button {
    position: fixed;
    bottom: 20px;
    padding: 8px 16px;
    color: #ffffff;
    font-family: "Trebuchet MS", "Arial", sans-serif;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    z-index: 1000;
  }

  .help-button {
    left: 20px;
  }
  .select-class-button {
    left: 100px;
  }

  .help-button:hover,
  .select-class-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .help-button:active,
  .select-class-button:active {
    transform: translateY(0);
  }

  /* Mobile Controls */
  .mobile-controls {
    display: none;
  }

  body.mobile .mobile-controls {
    display: flex;
    gap: 14px;
    position: fixed;
    bottom: 16px;
    right: 30px;
  }

  .mobile-button {
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    align-items: center;
    justify-content: center;
    display: flex;
    width: 50px;
    height: 50px;
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform, background-color;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    font-family: "Inter", sans-serif;
    font-size: 14px;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.8);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  }

  .mobile-button img {
    width: 22px;
    height: 22px;
  }

  #mobile-tackle-button img {
    width: 26px;
    height: 26px;
  }

  #mobile-sprint-button img {
    width: 26px;
    height: 26px;
  }

  .mobile-button.active {
    transform: scale(0.92);
    background-color: rgba(0, 0, 0, 0.75);
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
  }

  /* Animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes scaleIn {
    from {
      transform: translate(-50%, -50%) scale(0);
    }
    to {
      transform: translate(-50%, -50%) scale(1);
    }
  }

  @keyframes pulse {
    0% {
      opacity: 0.7;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0.7;
    }
  }
</style>
<div class="crosshair" id="crosshair"></div>

<div class="stamina-container">
  <div class="stamina-text" id="stamina-text">100</div>
  <div class="paint-splat-bg">
    <img
      id="paint-image"
      src="{{CDN_ASSETS_URL}}/ui/logos/blue-paint.png"
      alt="paint-splat"
      class="paint-splat-image"
    />
  </div>
</div>

<div class="score-time-container">
  <div class="team-banner red" id="red-banner">
    <div class="team-name">Red Raiders</div>
    <div class="team-score" id="red-score">0</div>
  </div>
  <div class="time-display">
    <span class="panel-value time-value" id="time-left">Waiting...</span>
  </div>
  <div class="team-banner blue" id="blue-banner">
    <div class="team-name">Blue Bandits</div>
    <div class="team-score" id="blue-score">0</div>
  </div>
</div>

<div class="game-over">
  <div class="game-over-content">
    <div class="winner-text" id="winner-text">Red Team Wins!</div>
  </div>
</div>

<div class="class-select panel-bg" id="class-select">
  <div class="close-button" id="close-class-select">×</div>
  <div class="class-card" id="runner-class">
    <div class="class-name">Runner</div>
    <img
      src="{{CDN_ASSETS_URL}}/ui/icons/runner.png"
      alt="Runner"
      class="class-icon"
    />
    <div class="class-desc">
      Fast-moving scout that leaves a trail of color behind them
    </div>
    <div class="class-stats">
      <div class="stat pro">+ Leave a trail of paint by walking</div>
      <div class="stat pro">+ Increased knockback on tackle</div>
      <div class="stat con">- No projectiles</div>
    </div>
  </div>

  <div class="class-card" id="slingshot-class">
    <div class="class-name">Slingshot</div>
    <img
      src="{{CDN_ASSETS_URL}}/ui/icons/slingshot.png"
      alt="slingshot"
      class="class-icon"
    />
    <div class="class-desc">Spray damage, shoot 3 paint balls at once</div>
    <div class="class-stats">
      <div class="stat pro">+ Shoot 3 paint balls at once</div>
      <div class="stat con">- Small splash radius</div>
    </div>
  </div>

  <div class="class-card" id="sniper-class">
    <div class="class-name">Sniper</div>
    <img
      src="{{CDN_ASSETS_URL}}/ui/icons/sniper.png"
      alt="sniper"
      class="class-icon"
    />
    <div class="class-desc">
      Long range fast bullets with knockback, shoot 1 paint ball at a time
    </div>
    <div class="class-stats">
      <div class="stat pro">+ Long range</div>
      <div class="stat pro">+ Fast bullets</div>
      <div class="stat con">- Small splash radius</div>
      <div class="stat con">- 1 bullet</div>
    </div>
  </div>

  <div class="class-card" id="grenader-class">
    <div class="class-name">Grenader</div>
    <img
      src="{{CDN_ASSETS_URL}}/ui/icons/grenader.png"
      alt="Grenader"
      class="class-icon"
    />
    <div class="class-desc">Area control expert with explosive projectiles</div>
    <div class="class-stats">
      <div class="stat pro">+ Large Splash</div>
      <div class="stat pro">+ Strong knockback</div>
      <div class="stat con">- Harder to aim</div>
      <div class="stat con">- Slower projectiles</div>
    </div>
  </div>
</div>

<div id="player-leaderboard">
  <div id="red-leaderboard" class="leaderboard"></div>
  <div id="blue-leaderboard" class="leaderboard"></div>
</div>

<div class="respawn-screen" id="respawn-screen">
  <div class="respawn-content">
    <div class="death-message" id="death-message">You fell off the map!</div>
    <div class="respawn-timer" id="respawn-timer">5</div>
  </div>
</div>

<div class="victory-screen" id="victory-screen">
  <div class="victory-content">
    <div class="victory-message">You win!</div>
    <div class="victory-team" id="victory-team"></div>
  </div>
</div>

<div class="defeat-screen" id="defeat-screen">
  <div class="defeat-content">
    <div class="defeat-message">You lose!</div>
    <div class="defeat-team" id="defeat-team"></div>
  </div>
</div>

<div class="player-stats">
  <div class="player-name" id="player-name">Player</div>
  <div class="stats-row">
    <div class="stat-counter points-count">
      <span class="stat-label">Points</span>
      <span class="stat-value" id="points-count">0</span>
    </div>
    <div class="stat-counter kills-count">
      <span class="stat-label">Knockouts</span>
      <span class="stat-value" id="kills-count">0</span>
    </div>
    <div class="stat-counter death-count">
      <span class="stat-label">Deaths</span>
      <span class="stat-value" id="death-count">0</span>
    </div>
  </div>
  <div class="current-class" id="current-class">Runner</div>
</div>

<div class="help-button panel-bg" id="help-button">Help</div>
<div class="select-class-button panel-bg" id="select-class-button">Class</div>

<div class="instructions" id="instructions">
  <div class="instructions-panel panel-bg">
    <div class="close-button" id="close-instructions">×</div>
    <h2 class="instructions-title">Block Splat</h2>
    <div class="instruction-section">
      <h3>Classes</h3>
      <ul>
        <li><strong>Runner</strong> - Colors blocks by walking</li>
        <li>
          <strong>Slingshot</strong> - Spray shots, higher stamina cost lower
          knockback
        </li>
        <li><strong>Grenader</strong> - Area control, heavy knockback</li>
        <li>
          <strong>Sniper</strong> - Long range, fast bullets, small spray radius
        </li>
      </ul>
    </div>
    <div class="instruction-section">
      <h3>Controls</h3>
      <ul>
        <li><strong>Left Click</strong> - Shoot</li>
        <li><strong>Q or Right Click</strong> - Tackle</li>
        <li><strong>1</strong> - Runner</li>
        <li><strong>2</strong> - Grenader</li>
        <li><strong>3</strong> - Sniper</li>
        <li><strong>4</strong> - Slingshot</li>
        <li><strong>E</strong> - Change Class</li>
        <li><strong>R</strong> - Leaderboard</li>
        <li><strong>V</strong> - Help</li>
      </ul>
    </div>
    <div class="instruction-section">
      <h3>Objective</h3>
      <p>
        Color more blocks than the enemy team before time runs out! Shoot paint
        balls that color blocks and push players off the map, to rack up
        Knockouts! Steal points from the other team by throwing paint at their
        colored blocks. Look out for power ups throughout the map to gain
        temporary boosts and increased stamina.
      </p>
    </div>
  </div>
</div>
<div class="mobile-controls">
  <a id="mobile-interact-button" class="mobile-button">
    <img src="{{CDN_ASSETS_URL}}/icons/target.png" />
  </a>
  <a id="mobile-tackle-button" class="mobile-button">
    <img src="{{CDN_ASSETS_URL}}/ui/icons/punch.svg" />
  </a>
  <a id="mobile-jump-button" class="mobile-button">
    <img src="{{CDN_ASSETS_URL}}/icons/jump.png" />
  </a>
  <a id="mobile-sprint-button" class="mobile-button">
    <img src="{{CDN_ASSETS_URL}}/ui/icons/sprint.png" />
  </a>
</div>

<script>
  hytopia.onData((data) => {
    if (data.type === "game-ui") {
      if (data.time !== undefined) {
        document.getElementById("time-left").textContent = data.time;
      }

      // Update points counter
      if (data.playerPoints !== undefined) {
        document.getElementById("points-count").textContent = data.playerPoints;
      }

      if (data.playerKills !== undefined) {
        document.getElementById("kills-count").textContent = data.playerKills;
      }

      if (data.playerClass !== undefined) {
        // capitalize the first letter of the class
        var className =
          data.playerClass.charAt(0).toUpperCase() + data.playerClass.slice(1);
        document.getElementById("current-class").textContent = className;
      }

      if (data.playerName !== undefined) {
        document.getElementById("player-name").textContent = data.playerName;
      }

      if (data.playerDeaths !== undefined) {
        document.getElementById("death-count").textContent = data.playerDeaths;
      }

      // Update stamina bar and paint image based on team
      if (data.playerStamina !== undefined) {
        const staminaText = document.getElementById("stamina-text");
        const paintImage = document.getElementById("paint-image");
        const percentage = (data.playerStamina / data.maxStamina) * 100;
        staminaText.textContent = `${Math.round(percentage)}%`;

        // Update paint image opacity and brightness based on percentage
        const opacity = Math.max(0.3, percentage / 100);
        paintImage.style.opacity = opacity;

        // Update paint image based on team
        if (data.playerTeam === "Red Raiders") {
          paintImage.src = "{{CDN_ASSETS_URL}}/ui/logos/red-paint.png";
        } else if (data.playerTeam === "Blue Bandits") {
          paintImage.src = "{{CDN_ASSETS_URL}}/ui/logos/blue-paint.png";
        }
      }

      // Parse the scores string and update the UI
      const scores = data.scores.split(" | ");
      scores.forEach((score) => {
        if (score.includes("Blue")) {
          document.getElementById("blue-score").textContent = score
            .split(": ")[1]
            .toLocaleString();
        } else if (score.includes("Red")) {
          document.getElementById("red-score").textContent = score
            .split(": ")[1]
            .toLocaleString();
        }
      });

      // Update team indicator
      document.getElementById("red-banner").classList.remove("your-team");
      document.getElementById("blue-banner").classList.remove("your-team");

      if (data.playerTeam === "Red Raiders") {
        document.getElementById("red-banner").classList.add("your-team");
      } else if (data.playerTeam === "Blue Bandits") {
        document.getElementById("blue-banner").classList.add("your-team");
      }

      // Set team color for nametags
      if (data.playerTeams !== undefined) {
        const nameTagContainers = document.getElementsByClassName("hytopia-nametag");
        Array.from(nameTagContainers).forEach((container) => {
          const playerNameElement = container.getElementsByClassName("hytopia-nametag-username")[0];
          if (playerNameElement) {
            const playerName = playerNameElement.textContent.trim();
            playerNameElement.style.color = "#ffffff";
            const playerTeamData = data.playerTeams.find(p => p.name === playerName);
            
            if (playerTeamData) {
              container.style.padding = "10px 16px";
              if (playerTeamData.team === "Red Raiders") {
                container.style.backgroundColor = "rgba(200, 30, 30, 0.75)";
              } else if (playerTeamData.team === "Blue Bandits") {
                container.style.backgroundColor = "rgba(30, 30, 200, 0.75)";
              }
            }
            
            if(playerName === data.playerName) {
              container.style.display = "none";
            }
          }
        });
      }
    }

    if (data.type === "game-over") {
      document.querySelector(".game-over").style.display = "block";
      document.getElementById(
        "winner-text"
      ).textContent = `${data.winner} Wins!`;
      document.getElementById("time-left").textContent = "Waiting...";
      // Hide game over message after 5 seconds
      setTimeout(() => {
        document.querySelector(".game-over").style.display = "none";
      }, 5000);
    }

    if (data.type === "player-death") {
      const respawnScreen = document.getElementById("respawn-screen");
      const respawnTimer = document.getElementById("respawn-timer");
      const deathMessage = document.getElementById("death-message");

      deathMessage.textContent = data.message || "You died!";
      respawnScreen.style.display = "block";

      let timeLeft = data.time;
      respawnTimer.textContent = timeLeft;

      const countdown = setInterval(() => {
        timeLeft--;
        respawnTimer.textContent = timeLeft;

        if (timeLeft <= 0) {
          clearInterval(countdown);
          respawnScreen.style.display = "none";
        }
      }, 1000);
    }

    if (data.type === "victory") {
      document.querySelector(".victory-screen").style.display = "block";
      document.getElementById(
        "victory-team"
      ).textContent = `${data.winner} Win!`;
      setTimeout(() => {
        document.querySelector(".victory-screen").style.display = "none";
      }, 5000);
    }

    if (data.type === "defeat") {
      document.querySelector(".defeat-screen").style.display = "block";
      document.getElementById(
        "defeat-team"
      ).textContent = `${data.winner} Win!`;
      setTimeout(() => {
        document.querySelector(".defeat-screen").style.display = "none";
      }, 5000);
    }

    if (data.type === "show-class-select") {
      const select = document.getElementById("class-select");
      if (select.style.display === "none") {
        select.style.display = "flex";
      } else {
        select.style.display = "none";
      }
    }

    if (data.type === "show-player-leaderboard") {
      if (
        document.getElementById("player-leaderboard").style.display === "none"
      ) {
        document.getElementById("player-leaderboard").style.display = "flex";
        const redLeaderboard = data.redLeaderboard;
        document.getElementById("red-leaderboard").innerHTML =
          '<div class="leaderboard-entry"><span class="leaderboard-name">Name</span><span class="leaderboard-points">Blocks Colored</span><span class="leaderboard-kills">Knockouts</span></div>';
        redLeaderboard.forEach((player) => {
          document.getElementById(
            "red-leaderboard"
          ).innerHTML += `<div class="leaderboard-entry"><span class="leaderboard-name">${player.name}</span><span class="leaderboard-points">${player.points}</span><span class="leaderboard-kills">${player.kills}</span></div>`;
        });

        const blueLeaderboard = data.blueLeaderboard;
        document.getElementById("blue-leaderboard").innerHTML =
          '<div class="leaderboard-entry"><span class="leaderboard-name">Name</span><span class="leaderboard-points">Points</span><span class="leaderboard-kills">Knockouts</span></div>';
        blueLeaderboard.forEach((player) => {
          document.getElementById(
            "blue-leaderboard"
          ).innerHTML += `<div class="leaderboard-entry"><span class="leaderboard-name">${player.name}</span><span class="leaderboard-points">${player.points}</span><span class="leaderboard-kills">${player.kills}</span></div>`;
        });
      } else {
        document.getElementById("player-leaderboard").style.display = "none";
      }
    }

    if (data.type === "player-id") {
      localStorage.setItem("playerId", data.playerId);
      const playerName = localStorage.getItem("playerName");
      if (playerName) {
        document.getElementById("player-name").textContent = playerName;
        hytopia.sendData({ type: "set-name", name: playerName });
      }
    }

    if (data.type === "set-name") {
      document.getElementById("player-name").textContent = data.name;
      localStorage.setItem("playerName", data.name);
    }
  });

  let selectedClass = null;

  function selectClass(className) {
    // Remove selected class from all cards
    document.querySelectorAll(".class-card").forEach((card) => {
      card.classList.remove("selected");
    });

    // Add selected class to clicked card
    document.getElementById(`${className}-class`).classList.add("selected");

    // Send selection to game
    hytopia.sendData({ button: "select-class", class: className });
    document.getElementById("current-class").textContent = className;

    // Hide class selection after choosing
    document.getElementById("class-select").style.display = "none";
  }

  // Add click handlers for class selection
  document
    .getElementById("runner-class")
    .addEventListener("click", () => selectClass("runner"));
  document
    .getElementById("slingshot-class")
    .addEventListener("click", () => selectClass("slingshot"));
  document
    .getElementById("sniper-class")
    .addEventListener("click", () => selectClass("sniper"));
  document
    .getElementById("grenader-class")
    .addEventListener("click", () => selectClass("grenader"));

  // Add touch handlers for class selection on mobile
  document
    .getElementById("runner-class")
    .addEventListener("touchstart", (e) => {
      e.preventDefault();
      selectClass("runner");
    });
  document
    .getElementById("slingshot-class")
    .addEventListener("touchstart", (e) => {
      e.preventDefault();
      selectClass("slingshot");
    });
  document
    .getElementById("sniper-class")
    .addEventListener("touchstart", (e) => {
      e.preventDefault();
      selectClass("sniper");
    });
  document
    .getElementById("grenader-class")
    .addEventListener("touchstart", (e) => {
      e.preventDefault();
      selectClass("grenader");
    });

  // Add click handler for close button
  document
    .getElementById("close-class-select")
    .addEventListener("click", () => {
      document.getElementById("class-select").style.display = "none";
    });

  // Add touch handler for close button on mobile
  document
    .getElementById("close-class-select")
    .addEventListener("touchstart", (e) => {
      e.preventDefault();
      document.getElementById("class-select").style.display = "none";
    });

  // Add help button functionality
  const helpButton = document.getElementById("help-button");
  const instructions = document.getElementById("instructions");

  function toggleInstructions() {
    instructions.classList.toggle("visible");
  }

  helpButton.addEventListener("click", toggleInstructions);

  // Add close button functionality
  document
    .getElementById("close-instructions")
    .addEventListener("click", toggleInstructions);

  // Add touch handler for instructions close button on mobile
  document
    .getElementById("close-instructions")
    .addEventListener("touchstart", (e) => {
      e.preventDefault();
      toggleInstructions();
    });

  // Add keyboard shortcut
  document.addEventListener("keydown", (event) => {
    if (event.key.toLowerCase() === "v") {
      toggleInstructions();
    }
  });

  // Add select class button functionality
  const selectClassButton = document.getElementById("select-class-button");
  selectClassButton.addEventListener("click", () => {
    const classSelect = document.getElementById("class-select");
    if (classSelect.style.display === "none" || !classSelect.style.display) {
      classSelect.style.display = "flex";
    } else {
      classSelect.style.display = "none";
    }
  });

  // Mobile touch handlers for help and class buttons
  helpButton.addEventListener("touchstart", (e) => {
    e.preventDefault();
    helpButton.classList.add("active");
    toggleInstructions();
  });

  helpButton.addEventListener("touchend", (e) => {
    e.preventDefault();
    helpButton.classList.remove("active");
  });

  selectClassButton.addEventListener("touchstart", (e) => {
    e.preventDefault();
    selectClassButton.classList.add("active");
    const classSelect = document.getElementById("class-select");
    if (classSelect.style.display === "none" || !classSelect.style.display) {
      classSelect.style.display = "flex";
    } else {
      classSelect.style.display = "none";
    }
  });

  selectClassButton.addEventListener("touchend", (e) => {
    e.preventDefault();
    selectClassButton.classList.remove("active");
  });
</script>
<script>
  // Handle interact button touch / untouch
  const mobileInteractButton = document.getElementById(
    "mobile-interact-button"
  );
  mobileInteractButton.addEventListener("touchstart", (e) => {
    e.preventDefault(); // Prevents mobile highlight/select/copy popup behaviors
    mobileInteractButton.classList.add("active"); // more immediate feedback to add/remove active class
    hytopia.pressInput("ml", true);
  });

  mobileInteractButton.addEventListener("touchend", (e) => {
    e.preventDefault();
    mobileInteractButton.classList.remove("active");
    hytopia.pressInput("ml", false);
  });

  // Handle jump button touch / untouch
  const mobileJumpButton = document.getElementById("mobile-jump-button");
  mobileJumpButton.addEventListener("touchstart", (e) => {
    e.preventDefault();
    mobileJumpButton.classList.add("active");
    hytopia.pressInput(" ", true);
  });

  mobileJumpButton.addEventListener("touchend", (e) => {
    e.preventDefault();
    mobileJumpButton.classList.remove("active");
    hytopia.pressInput(" ", false);
  });

  const mobileSprintButton = document.getElementById("mobile-sprint-button");
  mobileSprintButton.addEventListener("touchstart", (e) => {
    e.preventDefault();
    mobileSprintButton.classList.add("active");
    hytopia.pressInput("sh", true);
  });
  mobileSprintButton.addEventListener("touchend", (e) => {
    e.preventDefault();
    mobileSprintButton.classList.remove("active");
    hytopia.pressInput("sh", false);
  });

  const mobileTackleButton = document.getElementById("mobile-tackle-button");
  mobileTackleButton.addEventListener("touchstart", (e) => {
    e.preventDefault();
    mobileTackleButton.classList.add("active");
    hytopia.pressInput("mr", true);
  });

  mobileTackleButton.addEventListener("touchend", (e) => {
    e.preventDefault();
    mobileTackleButton.classList.remove("active");
    hytopia.pressInput("mr", false);
  });
</script>
